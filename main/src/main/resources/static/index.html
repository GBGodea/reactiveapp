<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>IoT Stream</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 20px; }
        header { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
        button { padding: 8px 12px; cursor: pointer; }
        .pill { padding: 6px 10px; border: 1px solid #ddd; border-radius: 999px; }
        .row { display:flex; gap:16px; flex-wrap:wrap; margin-top: 16px; }
        .card { border:1px solid #eee; border-radius:12px; padding:12px; min-width: 320px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border-bottom: 1px solid #f0f0f0; padding: 8px; text-align: left; font-size: 14px; }
        th { font-weight: 600; }
        .muted { color:#666; font-size: 12px; }
        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono"; }
        .log { max-height: 360px; overflow:auto; background:#fafafa; border:1px solid #eee; border-radius:12px; padding:10px; }
        .logline { border-bottom: 1px dashed #eee; padding: 6px 0; }
        .ok { color: #0a7; }
        .bad { color: #c33; }
        input[type="checkbox"] { transform: translateY(1px); }
    </style>
</head>
<body>
<header>
    <h2 style="margin:0;">IoT Stream (SSE)</h2>
    <span class="pill">Endpoint: <span class="mono">/api/stream</span></span>
    <button id="btnConnect">Подключиться</button>
    <button id="btnDisconnect" disabled>Отключиться</button>
    <span id="status" class="pill bad">OFFLINE</span>

    <label class="pill"><input id="fTemp" type="checkbox" checked> THERMOMETER</label>
    <label class="pill"><input id="fHum" type="checkbox" checked> HUMIDITY</label>
    <label class="pill"><input id="fMot" type="checkbox" checked> MOTION</label>
</header>

<div class="row">
    <div class="card" style="flex: 2;">
        <div style="display:flex;justify-content:space-between;align-items:baseline;">
            <h3 style="margin:0;">Последние значения по датчикам</h3>
            <div class="muted">Обновляется реактивно (scan + render)</div>
        </div>
        <table>
            <thead>
            <tr>
                <th>sensorId</th>
                <th>deviceId</th>
                <th>type</th>
                <th>value</th>
                <th>ts</th>
            </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

    <div class="card" style="flex: 1;">
        <div style="display:flex;justify-content:space-between;align-items:baseline;">
            <h3 style="margin:0;">Лог</h3>
            <div class="muted">последние 200 событий</div>
        </div>
        <div id="log" class="log"></div>
    </div>
</div>

<!-- RxJS 7 (UMD) -->
<script src="https://unpkg.com/rxjs@7/dist/bundles/rxjs.umd.min.js"></script>
<script src="/app.js"></script>
</body>
</html>
